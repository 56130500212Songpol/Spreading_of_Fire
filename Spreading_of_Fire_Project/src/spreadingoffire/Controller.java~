package speadingoffire;

import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.ButtonGroup;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JRadioButton;
import javax.swing.JSlider;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

/**
 * The controller class of project which contain buttons
 *
 * @author OOSD Project Group 5
 * @version 26/10/2014
 */
public class Controller extends JPanel {

    private JButton reset, auto, step, seeValue, seeBorder;
    private JSlider probCatchValue, probTreeValue, probBurningValue, delayValue;
    private JRadioButton tiny, small, medium, large, huge, world;
    private JRadioButton middle, random;
    private ButtonGroup group, group2;
    private JLabel size, probCatch, probTree, probBurning, delay, position,
            how, probCatchShow, probTreeShow, probBurningShow, delayShow;
    private JPanel buttonArea;
    private View view;
    private Model model;
    private boolean isRandom = false, isMiddle = false, isChangeSetting = false,
            isOnWorld = false;

    public Controller() {
        view = new View();
        model = new Model(view, 25, 1.0, 1.0, 0.0, 100);
        model.initForest();
        setLayout(new GridLayout());
        addInteractButton();
        addForestSizeRadioButton();
        addInitialBurningTreeRadioButton();
        addProbSlider();
        add(view);
    }

    private void addInteractButton() {
        how = new JLabel("**Please setting and regrow trees**");
        view.add(how);
        reset = new JButton("Regrow Trees");
        auto = new JButton("Auto Spread");
        step = new JButton("Step-by-Step");
        seeValue = new JButton("See Value of Cell");
        seeBorder = new JButton("See Border of Cell");

        step.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                if (!isChangeSetting) {
                    model.spreadStepbyStep();
                }
            }

        });

        auto.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                Thread t = new Thread(new Runnable() {
                    @Override
                    public void run() {
                        try {
                            if (!isChangeSetting) {
                                model.applySpread();
                            }
                        } catch (Exception e) {
                        }
                    }
                });
                t.start();
            }
        });

        reset.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                if (isRandom) {
                    model.setRandomPositionX();
                    model.setRandomPositionY();
                }
                view.setStep(0);
                model = new Model(view, model.getNumCell(), model.getPositionX(),
                        model.getPositionY(), model.getProbCatch(), model.getProbTree(),
                        model.getProbBurning(), model.getDelay());
                model.initForest();
                isChangeSetting = false;
            }
        });

        seeValue.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                if (!isOnWorld) {
                    if (view.isSeeValue() == false) {
                        view.setSeeValue(true);
                    } else if (view.isSeeValue() == true) {
                        view.setSeeValue(false);
                    }
                    if (!isChangeSetting) {
                        view.repaint();
                    }
                }
            }
        });

        seeBorder.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                if (!isOnWorld) {
                    if (view.isSeeEdge() == false) {
                        view.setSeeEdge(true);
                    } else if (view.isSeeEdge() == true) {
                        view.setSeeEdge(false);
                    }
                    if (!isChangeSetting) {
                        view.repaint();
                    }
                }
            }
        });

        view.add(reset);
        view.add(auto);
        view.add(step);
        view.add(seeValue);
        view.add(seeBorder);
    }

    private void addForestSizeRadioButton() {
        size = new JLabel("Choose Forest size :");
        view.add(size);
        group = new ButtonGroup();

        tiny = new JRadioButton("Tiny");
        tiny.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                view.setPixel(24);
                model.setNumCell(25);
                if (isRandom) {
                    model.setRandomPositionX();
                    model.setRandomPositionY();
                } else {
                    model.setPositionXonMiddle();
                    model.setPositionYonMiddle();
                }
                isChangeSetting = true;
                isOnWorld = false;
            }
        });

        small = new JRadioButton("Small");
        small.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                view.setPixel(15);
                model.setNumCell(41);
                if (isRandom) {
                    model.setRandomPositionX();
                    model.setRandomPositionY();
                } else {
                    model.setPositionXonMiddle();
                    model.setPositionYonMiddle();
                }
                isChangeSetting = true;
                isOnWorld = false;
            }
        });

        medium = new JRadioButton("Medium");
        medium.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                view.setPixel(10);
                model.setNumCell(63);
                if (isRandom) {
                    model.setRandomPositionX();
                    model.setRandomPositionY();
                } else {
                    model.setPositionXonMiddle();
                    model.setPositionYonMiddle();
                }
                isChangeSetting = true;
                isOnWorld = false;
            }
        });

        large = new JRadioButton("Large");
        large.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                view.setPixel(8);
                model.setNumCell(79);
                if (isRandom) {
                    model.setRandomPositionX();
                    model.setRandomPositionY();
                } else {
                    model.setPositionXonMiddle();
                    model.setPositionYonMiddle();
                }
                isChangeSetting = true;
                isOnWorld = false;
            }
        });

        huge = new JRadioButton("Huge");
        huge.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                view.setPixel(6);
                model.setNumCell(107);
                if (isRandom) {
                    model.setRandomPositionX();
                    model.setRandomPositionY();
                } else {
                    model.setPositionXonMiddle();
                    model.setPositionYonMiddle();
                }
                isChangeSetting = true;
                isOnWorld = false;
            }
        });

        world = new JRadioButton("World");
        world.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                view.setPixel(1);
                model.setNumCell(650);
                if (isRandom) {
                    model.setRandomPositionX();
                    model.setRandomPositionY();
                } else {
                    model.setPositionXonMiddle();
                    model.setPositionYonMiddle();
                }
                view.setSeeEdge(false);
                view.setSeeValue(false);
                isChangeSetting = true;
                isOnWorld = true;
            }
        });

        group.add(tiny);
        group.add(small);
        group.add(medium);
        group.add(large);
        group.add(huge);
        group.add(world);
        view.add(tiny);
        view.add(small);
        view.add(medium);
        view.add(large);
        view.add(huge);
        view.add(world);
    }

    private void addInitialBurningTreeRadioButton() {
        position = new JLabel("Select position of initial burn tree :");
        view.add(position);
        buttonArea = new JPanel();
        buttonArea.setLayout(new GridLayout(1, 2));
        group2 = new ButtonGroup();

        middle = new JRadioButton("Middle Tree");
        random = new JRadioButton("Random tree");

        middle.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                isRandom = false;
                isMiddle = true;
                model.setPositionXonMiddle();
                model.setPositionYonMiddle();
                System.out.println(model.getPositionX());
                System.out.println(model.getPositionY());
            }
        });
        random.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                isRandom = true;
                isMiddle = false;
                model.setRandomPositionX();
                model.setRandomPositionY();
                System.out.println(model.getPositionX());
                System.out.println(model.getPositionY());
            }
        });

        group2.add(middle);
        group2.add(random);
        buttonArea.add(middle);
        buttonArea.add(random);
        view.add(buttonArea);
    }

    private void addProbSlider() {
        probCatch = new JLabel("Choose Forest Probability Catching Fire :");
        probCatchShow = new JLabel("ProbCatch : ");
        view.add(probCatch);
        view.add(probCatchShow);
        probCatchValue = new JSlider(JSlider.HORIZONTAL, 0, 100, 100);
        probCatchValue.addChangeListener(new ChangeListener() {
            @Override
            public void stateChanged(ChangeEvent e) {
                if (probCatchValue.getValueIsAdjusting()) {
                    probCatchShow.setText("ProbCatch : " + (double) probCatchValue.getValue() + " %");
                    model.setProbCatch((double) probCatchValue.getValue() / 100);
                }
            }

        }
        );
        view.add(probCatchValue);

        probTree = new JLabel("Choose Forest Probability Tree density :");
        probTreeShow = new JLabel("ProbTree : ");
        view.add(probTree);
        view.add(probTreeShow);
        probTreeValue = new JSlider(JSlider.HORIZONTAL, 0, 100, 100);
        probTreeValue.addChangeListener(new ChangeListener() {
            @Override
            public void stateChanged(ChangeEvent e) {
                if (probTreeValue.getValueIsAdjusting()) {
                    probTreeShow.setText("ProbTree : " + (double) probTreeValue.getValue() + " %");
                    model.setProbTree((double) probTreeValue.getValue() / 100);
                }
            }

        }
        );
        view.add(probTreeValue);

        probBurning = new JLabel("Choose Forest Probability Tree burning :");
        probBurningShow = new JLabel("ProbBurning : ");
        view.add(probBurning);
        view.add(probBurningShow);
        probBurningValue = new JSlider(JSlider.HORIZONTAL, 0, 100, 0);
        probBurningValue.addChangeListener(new ChangeListener() {
            @Override
            public void stateChanged(ChangeEvent e) {
                if (probBurningValue.getValueIsAdjusting()) {
                    probBurningShow.setText("ProbBurning : " + (double) probBurningValue.getValue() + " %");
                    model.setProbBurning((double) probBurningValue.getValue() / 100);
                    if (isRandom) {
                        model.setRandomPositionX();
                        model.setRandomPositionY();
                    } else if (isMiddle) {
                        model.setPositionXonMiddle();
                        model.setPositionYonMiddle();
                    } else {
                        model.setRandomPositionX();
                        model.setRandomPositionY();
                        isRandom = true;
                    }
                }
            }

        }
        );
        view.add(probBurningValue);

        delay = new JLabel("Choose Forest Animation delay :");
        delayShow = new JLabel("Delay : ");
        view.add(delayShow);
        view.add(delay);
        delayValue = new JSlider(JSlider.HORIZONTAL, 2, 1000, 100);
        delayValue.addChangeListener(new ChangeListener() {
            @Override
            public void stateChanged(ChangeEvent e) {
                if (delayValue.getValueIsAdjusting()) {
                    delayShow.setText("Delay : " + delayValue.getValue() + " ms");
                    model.setDelay(delayValue.getValue());
                }
            }

        }
        );
        view.add(delayValue);
    }
}
